//
//  StoryModel.swift
//  LociTravel
//
//  Created by chohoseo on 8/6/25.
//
import Foundation
import UIKit

public struct Story {
    let spotName: String
    let questName: String
    let scenarioImage: String
    let characterImage: String
    let arrScenario: [(speaker: String, line: String)]
    let bgm: String
}

class StoryModel {
    static let shared = StoryModel()
    
    // MARK: - 프롤로그
    static let prologueTexts: [String] = [
        "프롤로그: 버려진 왕의 마지막 염원",
        "고조선의 마지막 왕 준위왕은 믿었던 위만에게 배신당해 홀로 익산 땅으로 도망친다.",
        "그는 죽음을 앞두고, 목걸이를 쪼개며 마지막 염원을 남긴다.",
        "\"이 목걸이가 합쳐지는 날, 이 땅에 피가 아닌 평화의 염원을 이을 왕이 통치하는 시대가 올것이다.\"",
        "목걸이의 한 조각은 한 고승에 의해 서동의 어머니에게 전해진다.",
        "고승은 울고 있는 어린 서동을 안고 있는 어머니에게 목걸이를 건네며, ",
        "훗날 이 아이가 평화의 시대를 열 운명을 지닌 아이가 될 것임을 암시한다.",
        "다른 한 조각은 다른 고승에 의해 신라의 왕과 왕비에게 전달된다.",
        "고승은 갓 태어난 선화공주를 안고 행복해하는 두 사람에게 목걸이를 건네며,",
        "이 아이가 평화의 염원을 잇는 중요한 존재가 될 것임을 예고한다.",
    ]
    
    // 5개의 프롤로그 이미지 파일 이름을 담는 배열
    // 이 파일들은 프로젝트의 Assets.xcassets에 추가되어야 합니다.
    static let prologueImageNames: [String] = [
        "prologue_image_1",
        "prologue_image_2",
        "prologue_image_3",
        "prologue_image_4",
        "prologue_image_5"
    ]
    
    // MARK: - 메인 스토리
    private var innerStories: [Story] = []
    
    private init() {
        innerStories = [
            Story(spotName: "서동시장", questName: "금가락지 소동", scenarioImage: "저잣거리", characterImage: "girl", arrScenario: dialogues_Market, bgm: "market"),
            Story(spotName: "보석 박물관", questName: "고대 퍼즐", scenarioImage: "소나무숲", characterImage: "girl", arrScenario: dialogues_Museum, bgm: "museum"),
            Story(spotName: "미륵사지", questName: "신탁의 문장", scenarioImage: "사찰", characterImage: "girl", arrScenario: dialogues_Temple, bgm: "temple"),
            Story(spotName: "서동공원", questName: "서동요의 비밀", scenarioImage: "호수", characterImage: "girl", arrScenario: dialogues_Park, bgm: "park"),
            Story(spotName: "왕궁리 유적", questName: "예언의 완성", scenarioImage: "궁궐", characterImage: "girl", arrScenario: dialogues_Palace_Intro, bgm: "palace_intro"),
            //Story(spotName: "에필로그", questName: "에필로그", scenarioImage: "background", characterImage: "girl", arrScenario: dialogues_Palace_Epilogue, bgm: "palace_epilogue")
        ]
    }
    
    public func getStories(spotName: String) -> Story {
        return innerStories.filter { $0.spotName == spotName }.first ?? innerStories[0]
    }
    
    //퀘스트뷰에서 가져올것
    public func getStory(for regionName: String, preferPostMission: Bool = false) -> Story {
        // 1) 정확 일치 우선
        if let exact = innerStories.first(where: { $0.spotName == regionName }) {
            return exact
        }
        
        // 2) 정규화 키로 후보 찾기
        let key = Self.baseKey(regionName)
        let candidates = innerStories.filter { Self.baseKey($0.spotName) == key }
        
        if !candidates.isEmpty {
            if preferPostMission {
                return candidates.first(where: { $0.spotName.contains("미션 후") }) ?? candidates[0]
            } else {
                return candidates.first(where: { $0.spotName.contains("미션 전") }) ?? candidates[0]
            }
        }
        
        // 3) 폴백
        return innerStories.first ?? Story(spotName: "", questName: "", scenarioImage: "", characterImage: "", arrScenario: [], bgm: "")
    }
    
    // ✅ [추가] 공백/괄호/“미션 전·후” 표기 제거해서 비교용 키 생성
    private static func baseKey(_ s: String) -> String {
        var t = s.replacingOccurrences(of: " ", with: "")
        // 다양한 표기 제거
        t = t.replacingOccurrences(of: "(미션전)", with: "")
            .replacingOccurrences(of: "(미션후)", with: "")
            .replacingOccurrences(of: "(미션 전)", with: "")
            .replacingOccurrences(of: "(미션 후)", with: "")
            .replacingOccurrences(of: "미션전", with: "")
            .replacingOccurrences(of: "미션후", with: "")
            .replacingOccurrences(of: "(", with: "")
            .replacingOccurrences(of: ")", with: "")
        return t
    }
    
    
}

// MARK: - 대사 데이터
let dialogues_Market: [(speaker: String, line: String)] = [
    ("", "서동 시장은 언제나 활기가 넘쳤지만, 서동에게는 하루하루가 고단한 생존의 싸움이었다."),
    ("", "그의 손에 쥐어진 것은 어머니의 유품인 낡은 목걸이 조각뿐이었다. 오늘도 서동은 직접 캐고 구운 고구마를 팔아 끼니를 해결하려 애쓰고 있었다."),
    ("서동", "에휴, 오늘은 얼마나 팔 수 있을까…."),
    ("아주머니1", "아이고, 서동아! 어제도 옆 동네 오씨네 지붕 고치는 거 도와줬다며? 다리 아파서 끙끙 앓더니, 네 덕분에 금세 끝냈다더구나."),
    ("아주머니2", "정말 착해. 자기 몸 하나 건사하기도 힘들 텐데, 저렇게 남 돕는 일에 앞장서는 마음씨가 보통이 아니지. 우리 마을에 저런 청년이 있다는 게 복이야."),
    ("", "그때, 왁자지껄한 시장 골목에서 눈부신 한 줄기 빛이 다가왔다. 하얀 비단옷을 입은 아름다운 처녀가 눈을 반짝이며 주위를 둘러보고 있었다."),
    ("선화", "와, 백제 시장은 신라랑은 또 다르네!"),
    ("", "선화는 눈앞에 펼쳐진 낯선 풍경에 홀려 주변을 살피다, 그만 정신없이 걷는 서동과 부딪히고 말았다."),
    ("서동", "아야…! 죄, 죄송합니다!"),
    ("선화", "어머, 괜찮아요? 제가 앞을 제대로 못 봤네요."),
    ("", "서동은 고개를 들었다. 눈앞에는 난생처음 보는 미인이 서 있었다. 그의 얼굴은 순식간에 붉어졌다."),
    ("서동", "아니요, 제가 괜찮습니다…."),
    ("선화", "후후, 참 재미있는 분이네요. 혹시 이곳에 대해 잘 아세요? 저는 멀리서 왔어요. 부모님께는 여행이라고 하고 왔지만… 사실은…."),
    ("", "선화의 눈이 이내 진지하게 변했다."),
    ("선화", "(속마음) 부모님께서 말씀하신 목걸이의 비밀을 풀기 위해 백제 땅에 왔어. 어머니의 목걸이 조각이 이 땅에 전해졌다고 했으니, 분명 단서가 있을 거야."),
    ("선화", "그리고 나는… 이 예언이 말하는 운명의 조각을 찾아야 해."),
    ("선화", "혹시 시간이 있으시다면, 저와 함께 백제를 구경시켜 주실 수 있나요? 제가 모든 고구마를 사드릴게요!"),
    ("서동", "네, 네! 물론입니다! 백제를 모두 보여드릴게요!"),
    ("", "서동의 가슴은 떨렸다. 이렇게, 두 사람의 운명적인 여행이 시작되었다."),
]

// MARK: - 대사 데이터: 보석박물관 (Museum)
let dialogues_Museum: [(speaker: String, line: String)] = [
    ("", "서동과 선화가 함께 도착한 곳은 소나무가 울창한 숲이었다. 그곳에는 바람에 실려온 솔향기가 가득했다."),
    ("선화", "와, 정말 아름답네요! 신라의 숲과는 또 다른 느낌이에요."),
    ("", "그때, 갑자기 숲 한쪽에서 수백 년 된 고목이 삐걱거리는 소리를 내며 기울기 시작했다. 최근 내린 폭우에 뿌리가 약해진 탓이었다."),
    ("", "그 아래에서 놀고 있던 아이들이 비명을 지르며 우왕좌왕했지만, 아이들의 발은 이미 잔뜩 엉켜버린 나뭇가지에 걸려 있었다."),
    ("", "사태를 파악한 서동은 위험을 무릅쓰고 고목 아래로 달려들었다. 그는 거대한 나무가 무너지기 직전, 아이들을 품에 안고 재빨리 밖으로 밀어냈다."),
    ("", "그의 팔에는 날카로운 나뭇가지에 베인 깊은 상처가 생겼지만, 그는 아랑곳하지 않았다."),
    ("자객", "(그 순간, 모두가 혼란에 빠진 틈을 타 검은 복면의 자객이 서동에게 달려들었다. 서동은 다친 팔로 몸을 피하려 했지만 역부족이었다.)"),
    ("자객", "(자객은 그의 품속에 있던 어머니의 목걸이를 낚아채 달아났다.)"),
    ("서동", "앗! 내 목걸이!"),
    ("", "놀란 선화는 자신의 허리춤에 달린 구슬을 움켜쥐었다. 도둑이 훔쳐 달아난 서동의 목걸이가 왠지 모르게 예사롭지 않아 보였기 때문이다."),
    ("", "고승이 말했던 '예언의 조각'이 서동의 목걸이와 관련이 있을지도 모른다는 생각에 선화의 눈빛이 흔들렸다."),
    ("서동", "어머니의 유품인데… 이걸 잃을 순 없습니다! 제가 꼭 되찾아올게요!"),
    ("선화", "혼자 가지 마세요! 서동님, 저도 함께 갈게요! 제게도 중요한… 중요한 의미가 있는 물건이니까요!"),
    ("", "서동은 어머니의 유품을, 선화는 예언의 조각을 되찾기 위해 자객을 쫓기 시작했다. 서로 다른 이유였지만, 두 사람의 발걸음은 하나의 운명을 향해 나아가고 있었다."),
    ("", "자객은 사람들 사이를 헤치고 미륵사지 방향으로 달아났다. 두 사람은 숨을 헐떡이며 그 뒤를 맹렬히 쫓았다.")
]


// MARK: - 대사 데이터: 미륵사지 (Temple)
let dialogues_Temple: [(speaker: String, line: String)] = [
    ("", "자객을 쫓아 도착한 곳은 미륵사지였다. 미륵사지의 웅장한 석탑은 고요함 속에서도 위대한 역사를 품고 있는 듯했다."),
    ("", "자객은 흔적도 없이 사라졌지만, 서동과 선화는 석탑 아래에서 찢어진 고서의 조각들을 발견했다. 그때, 한 노승이 두 사람에게 조용히 다가왔다."),
    ("승려", "어서 오시오. 젊은이들이여. 잃어버린 것을 찾고 계신 듯하오만…."),
    ("", "승려는 서동과 선화가 쥐고 있는 고서 조각을 보며 말했다. 그의 눈빛은 모든 것을 꿰뚫어 보는 듯 깊었다."),
    ("승려", "이것은 예언을 담고 있는 귀한 고서요. 하지만 안타깝게도 사악한 자들의 손에 의해 찢겨져 버렸지. 그들은 고서의 내용이 세상에 알려지는 것을 두려워하고 있소."),
    ("승려", "그대들이 잃어버린 목걸이 조각 또한 이 예언의 중요한 열쇠일 것이오."),
    ("", "승려는 서동과 선화에게 찢어진 고서 조각들을 모두 모아, 백제에서 가장 높은 사람에게 전달하라는 말을 남겼다."),
    ("", "서동은 자신과 어머니의 유품에 얽힌 비밀이 예언과 관련되어 있다는 사실에 놀라면서도, 백성들을 위한 평화의 염원이 담긴 고서를 복원해야 한다는 사명감을 느꼈다."),
    ("", "선화 역시 자신의 역할이 목걸이 조각을 찾는 것에 그치지 않음을 깨달았다. 두 사람은 함께 고서 조각을 찾아 나섰다."),
    ("선화", "승려님께서는 저희가 예언의 조각을 가진 것을 어떻게 아셨죠?"),
    ("승려", "그대들의 눈빛에서 진실된 마음이 보였소. 예언은 거짓된 자에게는 보이지 않는 법이지."),
    ("", "그들의 대화를 멀리서 지켜보는 두 그림자가 있었다. 복면을 쓴 자객과 고위 관료의 옷을 입은 진사평이었다. 진사평은 서동을 경멸하는 눈빛으로 바라보며 입을 열었다."),
    ("진사평", "쯧, 고작 저런 출신도 모르는 천한 놈이 예언의 주인공이라니. 말도 안 되는 소리. 목걸이와 고서를 모두 빼앗아 와라."),
    ("", "진사평의 명령에 자객은 고개를 숙였다. 서동과 선화의 운명적인 여정을 방해하려는 어둠의 그림자가 본격적으로 드리워지기 시작했다. 두 사람은 다음 단서가 있는 서동공원으로 발걸음을 옮겼다.")
]


// MARK: - 대사 데이터: 서동공원 (Park)
let dialogues_Park: [(speaker: String, line: String)] = [
    ("", "승려의 말을 따라 고서의 조각들을 찾기 위해, 서동과 선화가 다음 단서를 찾아 도착한 곳은 서동공원이었다."),
    ("", "그들은 미륵사지에서 가져온 고서 조각과 같은 문양이 새겨진 비석을 발견했다. 비석 아래에는 또 다른 고서의 조각이 숨겨져 있었다."),
    ("", "서동은 조심스럽게 고서 조각을 펼쳤다. 조각에는 알 수 없는 문자들이 적혀 있었다. 그는 조심스럽게 그것을 소리 내어 읽기 시작했다."),
    ("서동", "王者非血繼之者也… 太平之世將至之信…."),
    ("", "서동의 얼굴에서 핏기가 가시는 것을 본 선화가 걱정스러운 목소리로 물었다."),
    ("선화", "무슨 내용인가요?"),
    ("", "서동은 충격에 휩싸인 채 손을 떨었다. 고서는 '왕이란 피를 잇지 않은 자가 되려 한다'고 말하고 있었다."),
    ("", "자신 같은 천한 출신이 왕이 될 수 있다는 내용에 서동은 백제 왕실에 대한 '반역'으로 오해했다. 이 예언이 세상에 알려지면 선화까지 위험에 처할 것이라 생각한 서동은, 그녀를 지켜야 한다는 생각에 눈물을 머금고 모든 고서 조각을 품에 안은 채 떠나기로 결심했다."),
    ("서동", "(속마음) 이 위험한 운명에 그녀를 끌어들일 수는 없어. 내가 사라져야만, 그녀가 안전할 거야."),
    ("서동", "죄송합니다, 선화님. 저는 더 이상 당신과 함께할 수 없습니다."),
    ("", "서동은 뒤도 돌아보지 않고 황급히 자리를 떠났다. 홀로 남겨진 선화는 서동이 남긴 고서 조각을 바라보았다."),
    ("", "서동의 눈빛에 깃든 슬픔과 고통을 읽어낸 선화는 그의 진심을 알아차렸다. 그는 자신을 버린 것이 아니라, 자신을 지키려 떠난 것이었다."),
    ("선화", "(속마음) 서동님은 바보같이… 이 운명을 혼자 짊어지려 하는구나. 내가 찾아야 해!"),
    ("", "선화가 서동의 뒤를 쫓으려 발걸음을 옮기는 그때, 낯익은 목소리가 들려왔다. 백제 고위 관료의 아들인 진사평과 그의 호위무사들이었다."),
    ("진사평", "오랜만이군요, 선화공주. 신라의 둘째 공주께서 백제 땅에서 혼자 다니시다니 위험하오."),
    ("선화", "진사평…!"),
    ("", "선화의 얼굴에 경계심이 스쳤다. 진사평은 정략혼으로 맺어질 상대였지만, 선화는 그의 욕심과 다른 사람을 이용하려는 교활한 속내를 알고 있었다. 진사평은 서동이 사라진 것을 눈치채고 비릿한 미소를 지었다."),
    ("진사평", "나를 믿고 따르시오, 공주. 그대와 나는 운명으로 맺어진 사이 아닌가."),
    ("선화", "당신은 저를 원하지 않아요. 그저 저를 통해 백제의 권력을 손에 넣으려는 것뿐. 서동님을 찾으러 갈 겁니다."),
    ("", "진사평은 잠시 선화를 노려보았지만, 이내 가면을 쓴 채 부드러운 목소리로 말했다."),
    ("진사평", "흐음… 그렇다면 내가 직접 그 천한 놈을 찾아주겠소. 자, 나와 함께 가십시다."),
    ("", "선화는 진사평을 불신했지만, 서동을 찾기 위해 어쩔 수 없이 그의 제안을 받아들였다. 그렇게 두 사람은 진실과 기만을 품은 채 왕궁리 유적으로 향했다. 한 명은 엇갈린 운명의 상대를 찾아, 다른 한 명은 예언의 힘을 빼앗기 위해….")
]


// MARK: - 데사 데이터: 왕궁리 유적 도착 (미션 전)

let dialogues_Palace_Intro: [(speaker: String, line: String)] = [
    ("", "고서 조각을 품에 안고 홀로 도망치던 서동은 마침내 왕궁리 유적에 다다랐다. 그곳은 왁자지껄한 축제의 열기로 가득했다."),
    ("", "백성들은 풍년을 기념하는 큰 잔치를 벌이고 있었고, 평소처럼 마실을 나와 백성들과 어울리던 왕도 평범한 복장으로 축제를 즐기고 있었다."),
    ("", "하지만 제사상에 올린 촛불이 바람에 쓰러지면서 주변의 휘장에 불이 붙었고, 불길은 빠르게 번져 축제에 참여한 백성들과 왕을 덮쳤다."),
    ("", "사방이 불길에 갇히자 사람들은 비명을 지르며 우왕좌왕했다. 그때, 서동은 본인의 위험은 아랑곳하지 않고, 거세지는 불길 속으로 뛰어들어 화재 진압에 힘을 보탰다."),
    ("", "그런데 그때, 한 아이의 울음소리가 들려왔다. 불길이 휩싸인 천막 안에 갇힌 아이가 겁에 질려 떨고 있는 모습이 서동의 눈에 들어왔다."),
    ("", "서동은 주저 없이 아이를 구하기 위해 불 속으로 몸을 던졌다. 뜨거운 불꽃과 연기 속에서 아이를 품에 안고 겨우 빠져나왔지만, 맹렬한 불길에 서동의 몸은 크게 그슬렸고, 쓰러지는 기둥에 머리를 맞고 정신을 잃었다."),
    ("", "그의 머리에서는 피가 쏟아졌고, 숨조차 제대로 쉬지 못했다."),
    ("", "그때, 뒤늦게 왕궁리 유적에 도착한 진사평과 선화가 이 광경을 목격했다. 선화는 쓰러진 서동을 보자마자 비명을 지르며 달려갔지만, 진사평은 쓰러진 서동이 아닌, 그가 품고 있던 고서 조각에만 눈독을 들였다."),
    ("진사평", "흐흥, 결국 제 손으로 목숨을 끊는군. 이제 고서는 나의 것이…!"),
    ("자객", "(그 순간, 검은 복면의 자객이 서동의 등 뒤에서 홀연히 나타났다. 그는 진사평을 향해 맹렬히 달려들었다.)"),
    ("", "진사평의 호위 무사들과 격투를 벌이던 자객은, 이내 품속에서 서동의 목걸이를 꺼내 그의 가슴팍으로 힘껏 던졌다."),
    ("진사평", "네, 네놈이 어떻게 저 목걸이를 가지고 있는 것이냐!"),
    ("", "자객은 진사평의 분노 어린 외침에도 아랑곳하지 않고, 서동을 향해 낮은 목소리로 말했다."),
    ("자객", "나의 아버지는 과거 당신 덕분에 목숨을 구했소. 당신의 물품을 돌려드리려 여기까지 왔습니다. 부디 살아남으시오…."),
    ("", "자객은 자신의 정체를 드러낸 후 어둠 속으로 사라졌다. 진사평은 분노로 몸을 떨었고, 선화는 기적처럼 돌아온 서동의 목걸이를 보며 눈물을 흘렸다."),
    ("선화", "(그녀는 본능적으로 허리춤에 차고 있던 자신의 구슬이 이 목걸이와 한 짝인 여의주임을 깨달았다. 선화는 망설이지 않고 두 조각을 합쳐 서동의 가슴에 가져다 댔다.)"),
    ("", "합쳐진 목걸이와 여의주에서 신비로운 빛이 터져 나오며 서동의 온몸을 감쌌다. 기적 같은 일이 벌어졌다. 서동의 상처가 빠르게 아물었고, 멈추었던 그의 심장이 다시 뛰기 시작했다. 그는 이내 눈을 떴다."),
    ("", "그 순간, 하늘에서 조각난 고서의 문자들이 금빛으로 빛나며 울려 퍼졌다. 王者非血繼之者也, 太平之世將至之信…"),
    ("", "왕은 피로써가 아니라 평화의 시대가 도래할 것이란 우리들의 믿음을 잇는자이다."),
    ("", "백성들 사이에서 수군거림이 터져 나왔다. 그들 중에는 평범한 복장을 하고 모든 상황을 지켜보고 있던 백제의 왕이 있었다."),
    ("", "후사가 없어 고심하던 왕은, 고서의 내용을 읽고 백성을 위해 몸을 던진 서동, 그리고 기적적으로 살아난 현상을 보며 예언의 주인공이 바로 서동임을 깨달았다."),
    ("", "왕은 서동을 향해 나아가, 그의 손을 잡았다. 서동을 향한 백성들의 환호성과 함께, 백제의 새로운 시대가 시작되고 있었다. 진사평은 분노와 절망에 휩싸여 그 자리를 떠나고 말았다.")

]


// MARK: - 에필로그: 예언의 완성 (미션 후)
//
//let dialogues_Palace_Epilogue: [(speaker: String, line: String)] = [
//    ("조각이 맞춰지는 순간", "무왕이여, 백제를 다시 밝히라 – 예언의 문장이 허공에 떠오른다."),
//    ("선화", "목걸이가… 빛나고 있어요…!"),
//    ("서동", "무왕이라… 이게 바로 그 예언의 끝이구나."),
//    ("내레이션", "두 조각의 목걸이가 합쳐지자, 고조선의 마지막 왕 준위왕이 남긴 염원이 빛을 발하며 새로운 역사의 서막을 알렸다. 서동은 더 이상 마를 캐던 어린아이가 아니었다. 그는 백제의 새로운 왕, 무왕으로서 백성을 이끌 운명을 깨달았다. 신라의 공주 선화는 그저 정략적인 혼인의 대상이 아닌, 예언의 마지막 조각을 완성한 진정한 동반자였다."),
//    ("선화", "당신은 피로 이어진 왕이 아닌, 믿음으로 선택된 왕이에요."),
//    ("서동", "그렇소. 백제의 땅은 이미 수많은 피를 흘렸다오. 이제 그 피의 역사를 끝내고, 백성들의 믿음과 평화로 새로운 시대를 열어야 하오."),
//    ("선화", "당신의 마음이 백성의 마음과 함께하는 한, 백제는 영원히 빛날 거예요."),
//    ("서동", "이제, 우리가 함께 백제의 새로운 시대를 엽시다."),
//    ("내레이션", "서동의 목소리는 드넓은 왕궁을 넘어 백성들에게 닿았다. 백성들은 자신들의 삶을 보듬어 줄 진정한 왕의 탄생을 보며 환호했다."),
//    (" (백성들)", "만세! 만세! 무왕 만세!"),
//    ("내레이션", "무왕은 선화와 함께 손을 잡고 백성들을 향해 걸어 나갔다. 그들의 발걸음이 닿는 곳마다 평화의 기운이 싹트고, 새로운 희망이 피어났다. 준왕이 남긴 마지막 염원은 서동과 선화의 만남을 통해 평화와 화합의 백제를 완성하는 위대한 서사가 되었다."),
//    ("내레이션", "예언이 완성되었습니다. 당신의 이야기는 전설이 되었습니다.")
//]
